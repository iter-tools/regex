/* @macrome
 * @generatedby @macrome/generator-typescript
 * @generatedfrom ./index.ts#1653676938649
 * This file is autogenerated. Please do not edit it directly.
 * When editing run `npx macrome watch` then change the file this is generated from.
 */
"use strict";
Object.defineProperty(exports, "__esModule", {
  value: true
});

Object.defineProperty(exports, "Pattern", {
  enumerable: true,

  get: function() {
    return _pattern.Pattern;
  }
});

(exports.execGlobal = (exports.exec = void 0));

Object.defineProperty(exports, "parse", {
  enumerable: true,

  get: function() {
    return _pattern.parse;
  }
});

(exports.test = void 0);
var _peekerate = _interopRequireDefault(require("iter-tools-es/methods/peekerate"));
var _consume = _interopRequireDefault(require("iter-tools-es/methods/consume"));
var _api = require("./api");
var _engine = require("./internal/engine");
var _pattern = require("./pattern");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

const { exec, test, execGlobal } = new _api.Api(function* generate(
  pattern,
  iterable,
) {
  const peekr = (0, _peekerate.default)(iterable);
  const engine = new _engine.Engine(pattern);

  try {
    engine.feed(null);

    while (!engine.done && !(engine.starved && peekr.done)) {
      if (engine.starved && !peekr.done) {
        engine.feed(peekr.value);
        peekr.advance();
      } else if (engine.context.width === 0) {
        yield* engine.traverse0();
      } else {
        engine.traverse1();
      }
    }

    engine.feed(null);

    if (!engine.done) yield* engine.traverse0();
  } finally {
    peekr.return();
  }
});

exports.execGlobal = execGlobal;
exports.test = test;
exports.exec = exec;

const warmupPattern1 = (0, _pattern.parse)('.*', 'g');
const warmupPattern2 = (0, _pattern.parse)('(a)|(b)', 'g');

// Help avoid deopts when the setup and body of generate and step0 are hot
// but code to do with pattern or input termination is not
for (let i = 0; i < 4; i++) {
  (0, _consume.default)(execGlobal(warmupPattern1, 'ab'));
  (0, _consume.default)(execGlobal(warmupPattern2, 'ab'));
  (0, _consume.default)(execGlobal(warmupPattern2, 'a'));
  (0, _consume.default)(execGlobal(warmupPattern2, ''));
}
